---
title: "NOAA Storm Database - Analysis: Severe weather events"
author: "Santiago R"
date: "21 November 2017"
output:
        html_document:
                keep_md: true
---

```{r setup, include=FALSE}
rm(list = ls()) #Delete existing data in global environment
library(knitr)
library(lattice)
library(ggplot2)
library(dplyr)
library(anytime)
opts_chunk$set(echo = TRUE, cache = TRUE) ## Always show answers and avoid repeating unnecessary calculations
```

# Questions:

The data Analysis will address the following questions:


- Across the United States, which types of events (as indicated in the EVTYPE variable) are
most harmful with respect to population health?


- Across the United States, which types of events have the greatest economic consequences?

# Synopsis

Add here the Synopsis! **Pending**

# Data processing

## Reading the Data

``` {r readingData}
# for Reading Files *ZIP
fileUrl <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
download.file(fileUrl, "dataset.zip")
Rawdata <- read.csv("dataset.zip", header = TRUE, sep = ",", check.names = TRUE)

#Check data
str(Rawdata)
``` 

BGN_DATE represent a Date and is being shown as "Factor". TO convert to type: "Date"

``` {r changetodate}
#Make a copy of data to avoid reading again the file
Rawdata2 <- Rawdata
Rawdata2$BGN_DATE <- as.Date(Rawdata2$BGN_DATE, "%m/%d/%Y")
#validate if type of data for "Date" has changed
str(Rawdata2$BGN_DATE)

```

One of the Questions is to know which Event Type has been more harmful with respect to
population. 

The first approach is to validate wich Event Type has occurred more times

```{r MostrepeatedEvent}
EventTypeSummary <- table(Rawdata2$EVTYPE)
EventTypeSummary <- data.frame(EventTypeSummary)
EventTypeSummary <- arrange(EventTypeSummary, desc(Freq))
head(EventTypeSummary, 5)
``` 
From this table, we can think that `r EventTypeSummary$Var1[[1]]` is the event that happens
the most in USA. Nevertheless, it does not guarantee that it is the most harmful for the 
population.

To validate the Harmfulness, the "Fatalities" and "Injuries" caused by the events will be
analyzed.

```{r fatalitiesInjuries}
FatalitiesInjuries <- subset(Rawdata2, select =  c(STATE, BGN_DATE, EVTYPE, FATALITIES, INJURIES))
EvFatalities <- aggregate(FatalitiesInjuries$FATALITIES, by = list(FatalitiesInjuries$EVTYPE), FUN = sum)
EvInjuries <- aggregate(FatalitiesInjuries$INJURIES, by = list(FatalitiesInjuries$EVTYPE), FUN = sum)
#Order the Data from Higher to lower to see the events with more fatal and injure events:

EvFatalities <- arrange(EvFatalities, desc(x))
EvInjuries <- arrange(EvInjuries, desc(x))
HarmfulEvents <- merge(EvFatalities, EvInjuries, by = "Group.1", all = TRUE)
HarmfulEvents <- arrange(HarmfulEvents, desc(x.x))
names <- c("EVTYPE", "FATALITIES", "INJURIES")
colnames(HarmfulEvents) <- names
head(HarmfulEvents, 5)
```

Here, one can see that **TORNADO** and **EXCESSIVE HEAT** have the higher values in Fatalities.
Comparing with the frequency of the events (Table shown above "EventTypeSummary"), the 
Frequency of the events is not directly related with the Harmfulness. 

Considering that the Fatal cases are worst as the Injuries, but without taking out consideration
the injuries, a Weighted calculation is made, where a weight of "5" is given to "Fatality"
and a Weight of "1" to "Injury"

```{r weightedvalue}
HarmfulEvents2 <- HarmfulEvents
HarmfulEvents2 <- HarmfulEvents2 %>% mutate(WeightedValue = FATALITIES*5 + INJURIES)
HarmfulEvents2 <- arrange(HarmfulEvents2, desc(WeightedValue))
head(HarmfulEvents2, 5)
```
With this conisderation, the most harmful event is the **TORNADO**, followed by the **EXCESIVE HEAT**
To be clear with the "Weighted value", this result might vary according to the weight given
to the "FATALITY". To validate its impact, another calculation with a higher weight is made to see
if the top 3 events vary:

```{r weightedvalue2}
HarmfulEvents2 <- HarmfulEvents
HarmfulEvents2 <- HarmfulEvents2 %>% mutate(WeightedValue = FATALITIES*10 + INJURIES)
HarmfulEvents2 <- arrange(HarmfulEvents2, desc(WeightedValue))
head(HarmfulEvents2, 3)
```

### Answer Question 1
* It is clear that **TORNADO** and **EXCESIVE HEAT** are the 2 most harmful events in the USA.
